{% extends "base.html" %}

{% block content %}
<div class="page-wrapper">
    <!-- Header de edición -->
    <div class="dashboard-header">
        <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
            <div class="flex-grow-1">
                <h2 class="mb-1 text-white">
                    <i class="bi bi-pencil-square"></i> Editar Componente
                </h2>
                <p class="text-white opacity-75 mb-0">Modifica la información del componente seleccionado</p>
            </div>
            <div class="d-flex align-items-center gap-2 flex-wrap">
                <a href="{{ url_for('lista_componentes') }}" class="btn btn-outline-light btn-sm">
                    <i class="bi bi-arrow-left"></i> 
                    <span class="d-none d-md-inline">Volver a Componentes</span>
                    <span class="d-md-none">Volver</span>
                </a>
                {% if componente %}
                <a href="{{ url_for('vista_componente', id=componente.ID) }}" class="btn btn-outline-light btn-sm">
                    <i class="bi bi-eye"></i> 
                    <span class="d-none d-md-inline">Ver Componente</span>
                    <span class="d-md-none">Ver</span>
                </a>
                {% endif %}
                <div class="badge bg-light text-dark fs-6 d-none d-lg-block">
                    <i class="bi bi-calendar3"></i> <span id="current-date"></span>
                </div>
                <button class="theme-toggle" id="themeToggle">
                    <i class="bi bi-moon-fill" id="themeIcon"></i>
                </button>
            </div>
        </div>
    </div>

    <div class="row g-4">
        <!-- Formulario principal -->
        <div class="col-lg-8">
            <div class="card-section">
                <h3 class="section-title">
                    <i class="bi bi-info-circle"></i> Información del Componente
                </h3>
                
                <form method="POST" enctype="multipart/form-data" id="editComponentForm">
                    <div class="row g-3">
                        <!-- Código del componente -->
                        <div class="col-md-6">
                            <label for="codigo" class="form-label">
                                <i class="bi bi-hash"></i> Código del Componente
                            </label>
                            <input type="text" 
                                class="form-control" 
                                id="codigo" 
                                name="codigo" 
                                value="{{ componente.ID_Componente if componente and componente.ID_Componente is not none else '' }}"
                                placeholder="Ej: C001, FILT-001">
                            <div class="form-text">Código único para identificar el componente</div>
                        </div>

                        <!-- Nombre -->
                        <div class="col-md-6">
                            <label for="nombre" class="form-label required">
                                <i class="bi bi-tag"></i> Nombre del Componente
                            </label>
                            <input type="text" 
                                class="form-control" 
                                id="nombre" 
                                name="nombre" 
                                value="{{ componente.Nombre if componente and componente.Nombre is not none else '' }}"
                                required 
                                placeholder="Ej: Filtro de aceite">
                        </div>

                        <!-- Tipo -->
                        <div class="col-md-6">
                            <label for="tipo" class="form-label">
                                <i class="bi bi-collection"></i> Tipo de Componente
                            </label>
                            <select class="form-select" id="tipo" name="tipo">
                                <option value="">Seleccionar tipo...</option>
                                {% set tipo_actual = componente.Tipo if componente and componente.Tipo is not none else '' %}
                                <option value="Filtro" {{ 'selected' if tipo_actual == 'Filtro' else '' }}>Filtro</option>
                                <option value="Correa" {{ 'selected' if tipo_actual == 'Correa' else '' }}>Correa</option>
                                <option value="Válvula" {{ 'selected' if tipo_actual == 'Válvula' else '' }}>Válvula</option>
                                <option value="Sensor" {{ 'selected' if tipo_actual == 'Sensor' else '' }}>Sensor</option>
                                <option value="Bomba" {{ 'selected' if tipo_actual == 'Bomba' else '' }}>Bomba</option>
                                <option value="Motor" {{ 'selected' if tipo_actual == 'Motor' else '' }}>Motor</option>
                                <option value="Hidráulico" {{ 'selected' if tipo_actual == 'Hidráulico' else '' }}>Hidráulico</option>
                                <option value="Eléctrico" {{ 'selected' if tipo_actual == 'Eléctrico' else '' }}>Eléctrico</option>
                                <option value="Mecánico" {{ 'selected' if tipo_actual == 'Mecánico' else '' }}>Mecánico</option>
                                <option value="Otro" {{ 'selected' if tipo_actual == 'Otro' else '' }}>Otro</option>
                            </select>
                        </div>

                        <!-- Marca -->
                        <div class="col-md-6">
                            <label for="marca" class="form-label">
                                <i class="bi bi-award"></i> Marca
                            </label>
                            <input type="text" 
                                class="form-control" 
                                id="marca" 
                                name="marca" 
                                value="{{ componente.Marca if componente and componente.Marca is not none else '' }}"
                                placeholder="Ej: Bosch, Mann, Fleetguard">
                        </div>

                        <!-- Modelo -->
                        <div class="col-md-6">
                            <label for="modelo" class="form-label">
                                <i class="bi bi-gear"></i> Modelo
                            </label>
                            <input type="text" 
                                class="form-control" 
                                id="modelo" 
                                name="modelo" 
                                value="{{ componente.Modelo if componente and componente.Modelo is not none else '' }}"
                                placeholder="Ej: W712/75, HF6177">
                        </div>

                        <!-- Precio -->
                        <div class="col-md-6">
                            <label for="precio" class="form-label">
                                <i class="bi bi-currency-dollar"></i> Precio Unitario
                            </label>
                            <div class="input-group">
                                <span class="input-group-text">$</span>
                                <input type="number" 
                                    class="form-control" 
                                    id="precio" 
                                    name="precio" 
                                    value="{{ componente.Precio if componente and componente.Precio is not none else '' }}"
                                    step="0.01" 
                                    min="0"
                                    placeholder="0.00">
                            </div>
                        </div>

                        <!-- Descripción -->
                        <div class="col-12">
                            <label for="descripcion" class="form-label">
                                <i class="bi bi-card-text"></i> Descripción
                            </label>
                            <textarea class="form-control" 
                                    id="descripcion" 
                                    name="descripcion" 
                                    rows="4" 
                                    placeholder="Describe las características, función y detalles técnicos del componente...">{{ componente.Descripcion if componente and componente.Descripcion is not none else '' }}</textarea>
                        </div>

                        <!-- Imagen -->
                        <div class="col-12">
                            <label for="foto" class="form-label">
                                <i class="bi bi-image"></i> Imagen del Componente
                            </label>
                            <input type="file" 
                                class="form-control" 
                                id="foto" 
                                name="foto" 
                                accept="image/*">
                            <div class="form-text">
                                Formatos soportados: JPG, PNG, GIF. Tamaño máximo: 5MB
                                {% if componente and componente.Foto %}
                                    <br><small class="text-muted">Imagen actual: {{ componente.Foto }}</small>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Botones de acción -->
                    <div class="d-flex gap-3 mt-4 pt-3 border-top">
                        <button type="submit" class="btn btn-agri-primary">
                            <i class="bi bi-check-lg"></i> Guardar Cambios
                        </button>
                        <a href="{{ url_for('lista_componentes') }}" class="btn btn-outline-secondary">
                            <i class="bi bi-x-lg"></i> Cancelar
                        </a>
                        {% if componente %}
                        <button type="button" class="btn btn-outline-danger ms-auto" onclick="confirmDelete()">
                            <i class="bi bi-trash"></i> Eliminar Componente
                        </button>
                        {% endif %}
                    </div>
                </form>
            </div>
        </div>

        <!-- Panel lateral -->
        <div class="col-lg-4">
            <!-- Vista previa de imagen -->
            <div class="card-section mb-4">
                <h4 class="section-title">
                    <i class="bi bi-image"></i> Vista Previa
                </h4>
                <div class="image-preview-container">
                    {% if componente and componente.Foto and componente.Foto != '' %}
                        <img src="{{ url_for('static', filename='fotos/componentes/' ~ componente.Foto) }}" 
                            class="img-fluid rounded shadow" 
                            alt="{{ componente.Nombre if componente.Nombre else 'Componente' }}"
                            id="imagePreview">
                    {% else %}
                        <div class="image-placeholder" id="imagePlaceholder">
                            <i class="bi bi-image"></i>
                            <p>Sin imagen</p>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Información adicional -->
            <div class="card-section">
                <h4 class="section-title">
                    <i class="bi bi-info-circle"></i> Información
                </h4>
                <div class="info-list">
                    {% if componente %}
                    <div class="info-item">
                        <span class="info-label">ID del componente</span>
                        <span class="info-value">{{ componente.ID if componente.ID else 'N/A' }}</span>
                    </div>
                    {% if componente.ID_Componente %}
                    <div class="info-item">
                        <span class="info-label">Código</span>
                        <span class="info-value">{{ componente.ID_Componente }}</span>
                    </div>
                    {% endif %}
                    {% endif %}
                    <div class="info-item">
                        <span class="info-label">Estado</span>
                        <span class="info-value">
                            <span class="badge bg-warning">En edición</span>
                        </span>
                    </div>
                </div>

                <!-- Consejos -->
                <div class="mt-4 p-3 bg-light rounded">
                    <h6 class="text-agri-primary mb-2">
                        <i class="bi bi-lightbulb"></i> Consejos
                    </h6>
                    <ul class="small mb-0">
                        <li>Usa códigos únicos para facilitar la búsqueda</li>
                        <li>Incluye marca y modelo para mejor identificación</li>
                        <li>Agrega una imagen clara del componente</li>
                        <li>Describe la función y características técnicas</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<script></script>
<style></style>
{% endblock %}
