{% extends "base.html" %}

{% block title %}Compra {{ compra.ID_Compra }}{% endblock %}

{% block content %}
<div class="page-wrapper">

    <!-- Header -->
    <div class="dashboard-header hidden-item p-4 mb-3 rounded">
        <div class="header-topbar">
            <div class="header-title">
                <h2 class="section-title"><i class="bi bi-cart-check-fill"></i> Compra N° {{ compra.ID_Compra }}</h2>
                <p class="section-subtitle d-none d-md-block opacity-75">Detalle de la compra registrada</p>
            </div>
            <div class="header-controls">
                <a href="{{ url_for('compras.historial_compras') }}" 
                    class="btn btn-outline-primary btn-sm ms-auto">
                    <i class="bi bi-arrow-left"></i> 
                    <span class="d-none d-md-block d-md-inline">Volver</span>
                </a>
                <a href="{{ url_for('index') }}" 
                    class="btn btn-outline-primary btn-sm" 
                    style="font-size: 1rem;">
                    <i class="bi bi-house"></i> 
                    <span class="d-none d-md-block d-md-inline">Inicio</span>
                </a>
                <a href="{{ url_for('compras.editar_compra', id_compra=compra.ID_Compra) }}" 
                    class="btn btn-outline-primary btn-sm">
                    <i class="bi bi-pencil-square"></i> 
                    <span class="d-none d-md-inline">Editar</span>
                </a>
                <button class="theme-toggle" id="themeToggle">
                    <i class="bi bi-moon-fill" id="themeIcon"></i>
                </button>
                <div class="calendar-badge fs-6 d-none d-lg-block">
                    <i class="bi bi-calendar3"></i><span id="current-date"></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Cuerpo -->
    <div class="row g-4">
        <!-- Información de compra -->
        <div class="col-lg-8">
            <div class="card-section hidden-item p-3 shadow-sm rounded">
                <h3 class="section-title mb-4"><i class="bi bi-receipt"></i> Información General</h3>
                <div class="row gy-4 gx-3">
                    
                    <!-- Proveedor -->
                    <div class="col-md-6 d-flex flex-column">
                        <label class="form-label fw-semibold mb-1">
                            <i class="bi bi-person-badge"></i> Proveedor
                        </label>
                        <div class="form-control-plaintext fs-5">
                            {{ compra.Proveedor.Nombre or 'Desconocido' }}
                        </div>
                    </div>

                    <!-- Componente -->
                    <div class="col-md-6 d-flex flex-column">
                        <label class="form-label fw-semibold mb-1">
                            <i class="bi bi-box"></i> Componente
                        </label>
                        <div class="form-control-plaintext fs-5">
                            {{ compra.Componente.Nombre or 'Eliminado o no asignado' }}
                        </div>
                    </div>

                    <!-- Cantidad -->
                    <div class="col-md-4 d-flex justify-content-between align-items-center">
                        <label class="form-label fw-semibold mb-0">
                            <i class="bi bi-hash"></i> Cantidad
                        </label>
                        <div class="form-control-plaintext fs-5 text-end">{{ compra.Cantidad }}</div>
                    </div>

                    <!-- Precio Total -->
                    <div -class="col-md-4 d-flex justify-content-between align-items-center">
                        <label class="form-label fw-semibold mb-0">
                            <i class="bi bi-calculator"></i> Precio
                        </label>
                        <div class="form-control-plaintext fs-5 text-end">
                            ${{ '%.2f' | format(compra.Cantidad * compra.Precio_Unitario) }}
                        </div>
                    </div>

                    <!-- Fecha -->
                    <div class="col-md-4 d-flex justify-content-between align-items-center">
                        <label class="form-label fw-semibold mb-0">
                            <i class="bi bi-calendar-check"></i> Fecha 
                        </label>
                        <div class="form-control-plaintext fs-5 text-end">
                            {{ compra.Fecha.strftime('%Y-%m-%d') }}
                        </div>
                    </div>

                    <!-- Observación -->
                    {% if compra.Observacion %}
                    <div class="col-12">
                        <label class="form-label fw-semibold mb-1">
                            <i class="bi bi-chat-dots"></i> Observación
                        </label>
                        <div class="form-control-plaintext fs-6">{{ compra.Observacion }}</div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Acciones y links -->
        <div class="col-lg-4">
            <div class="card-section hidden-item compact-panel">
                <h4 class="section-title mb-3"><i class="bi bi-lightning"></i> Acciones Rápidas</h4>

                {% if compra.ID_Componente %}
                <a href="{{ url_for('componentes.vista_componente', id=compra.ID_Componente) }}" class="btn btn-agri-secondary btn-sm w-100 mb-2">
                    <i class="bi bi-box-seam"></i> Ver Componente
                </a>
                {% else %}
                <button class="btn btn-agri-secondary btn-sm w-100 mb-2" disabled>No hay componente</button>
                {% endif %}

                {% if compra.ID_Proveedor %}
                <a href="{{ url_for('proveedores.ver_proveedor', id=compra.ID_Proveedor) }}" class="btn btn-agri-primary btn-sm w-100 mb-2">
                    <i class="bi bi-person-lines-fill"></i> Ver Proveedor
                </a>
                {% else %}
                <button class="btn btn-agri-primary btn-sm w-100 mb-2" disabled>No hay proveedor</button>
                {% endif %}

                <a href="{{ url_for('compras.registrar_compra') }}" class="btn btn-outline-tertiary btn-sm w-100">
                    <i class="bi bi-cart-plus"></i> Nueva Compra
                </a>
            </div>
        </div>
    </div>


</div>
<style>
h3 > i {
    font-size: 1.8rem;
    vertical-align: middle;
}
label > i {
    font-size: 1.5rem;
    vertical-align: middle;
    text-align: right;
}
.form-control-plaintext {
    padding-left: 2.3em;
    padding-right: 1.7em;
}
</style>
{% endblock %}
