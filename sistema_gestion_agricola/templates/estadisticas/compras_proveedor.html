{% extends "base.html" %}

{% block title %}Componentes{% endblock %}

{% block content %}
<div class="page-wrapper">
  <!-- Header -->
  <div class="dashboard-header hidden-item p-4 mb-3 rounded">
    <div class="header-topbar">
      <div class="header-title">
        <h2 class="section-title"><i class="bi bi-puzzle-fill"></i> Análisis visual</h2>
      </div>
      <div class="header-controls">
        <a href="{{ url_for('index') }}" 
          class="btn btn-outline-primary btn-sm ms-auto">
          <i class="bi bi-house"></i> 
          <span class="d-none d-md-block d-md-inline">Inicio</span>
        </a>
        <button class="theme-toggle" id="themeToggle">
          <i class="bi bi-moon-fill" id="themeIcon"></i>
        </button>
        <div class="calendar-badge fs-6 d-none d-lg-block">
          <i class="bi bi-calendar3"></i> <span id="current-date"></span>
        </div>
      </div>
    </div>
  </div>
  <!-- Gráfico de compras por proveedor -->
  <div class="card-section hidden-item mb-0">
    <h3 class="section-title">
      <i class="bi bi-bar-chart-line-fill"></i> Compras Totales por Proveedor
    </h3>
    <div class="chart-container" style="position: relative; height: 420px;">
      <canvas id="graficoProveedor"></canvas>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>

    const labels = {{ labels | tojson | safe }};
    const values = {{ values | tojson | safe }};

    const backgroundColors = labels.map((_, i) =>
        `hsl(${i * 40 % 360}, 70%, 60%)`
    );

    const ctx = document.getElementById('graficoProveedor').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Total Comprado ($)',
                data: values,
                backgroundColor: backgroundColors,
                borderColor: 'rgba(0, 0, 0, 0.1)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                tooltip: {
                    callbacks: {
                        label: context => {
                            const value = context.parsed.y;
                            return ` $${value.toLocaleString('es-AR', { minimumFractionDigits: 2 })}`;
                        }
                    }
                },
                legend: { display: false },
            },
            scales: {
                x: {
                    ticks: {
                        callback: function(value, index) {
                            const label = this.getLabelForValue(value);
                            return label.length > 12 ? label.slice(0, 12) + '…' : label;
                        },
                        autoSkip: false,
                        maxRotation: 45,
                        minRotation: 20
                    },
                    grid: { display: false }
                },
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: value => '$' + value.toLocaleString('es-AR')
                    },
                    grid: {
                        color: 'rgba(0,0,0,0.05)'
                    }
                }
            }
        }
    });

</script>

<style>

.chart-container {
  position: relative;
  height: 400px;
}

@media (max-width: 576px) {
  .chart-container {
    height: 300px;
  }
}

</style>

{% endblock %}